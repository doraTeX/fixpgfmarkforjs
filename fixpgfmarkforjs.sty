\NeedsTeXFormat{pLaTeX2e}
\ProvidesPackage{fixpgfmarkforjs}[2019/05/15, v0.02]
\RequirePackage{pgf}

\@ifpackageloaded{gentombow}{
  \if 1\pxgtmb@pdfbox@status%% for [pdfbox] option
    \def\pgf@sys@pdf@mark@pos@pgfpageorigin{%
      \pgf@x=\dimexpr \hoffset + 1in\relax
      \pgf@y=\dimexpr - \voffset - 1in + \stockheight - \paperheight \relax
      \ignorespaces
    }
  \else%% when [pdfbox] option is not given
    \def\pgf@sys@pdf@mark@pos@pgfpageorigin{%
      \pgf@x=\dimexpr \hoffset + 1in\relax
      \pgf@y=\dimexpr -\voffset - 1in + \stockheight - \paperheight \relax%%% THIS DOES NOT WORK!!
      \ignorespaces
    }
  \fi
}{%
  \ifpapersize %% for [papersize] option of jsclasses
    \def\pgf@sys@pdf@mark@pos@pgfpageorigin{%
      \pgf@x=\dimexpr 1in \iftombow\else - 1truein\fi\relax
      \pgf@y=\dimexpr -1in + \iftombow \stockheight - \paperheight \else 1truein\fi\relax
      \ignorespaces
    }
  \else %% for geometry package
    \@ifpackageloaded{geometry}{%
      \def\pgf@sys@pdf@mark@pos@pgfpageorigin{%
        \pgf@x=\dimexpr 1in - 1truein\relax
        \pgf@y=\dimexpr - 1in + 1truein\relax
        \ignorespaces
      }
      \expandafter\def\csname pgf@sh@np@current page\endcsname{%
        \def\southwest{\pgfpointorigin}%
        \def\northeast{\pgfpoint{\pgfsys@thepagewidth/\the\mag*1000}{\pgfsys@thepageheight/\the\mag*1000}}%
      }
    }{}
  \fi
}

\endinput
